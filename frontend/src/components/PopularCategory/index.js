import React, { useState, useEffect } from "react";
import Link from "next/link";
import AllCategoryPop from "./AllCategoryPop";
import { useAuth } from "@/context/AuthContext";

const viewMore = {
  title: "View More",
  svg: `
    <svg
      width="65"
      height="65"
      viewBox="0 0 65 65"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M38.0846 19.2544C37.6682 16.2187 33.5715 16.2027 31.2774 16.5396C27.2005 17.1384 26.6207 18.2177 27.5599 22.0615C27.798 23.0361 28.8721 26.816 28.295 27.5723C27.8104 28.2074 26.8139 27.8749 26.1545 27.7927C24.8343 27.6281 20.5302 26.8525 19.5783 27.0205C16.9023 27.4928 16.9461 32.6643 17.423 34.8719C18.3369 35.3585 21.9551 34.9538 23.0083 34.8663C23.752 34.8044 25.0694 34.5877 25.7175 34.6404C29.3965 34.9395 27.859 40.7549 27.5421 42.9873C27.4595 43.569 27.326 44.2046 27.3437 44.7923C27.9367 44.959 28.5597 45.0672 29.166 45.1738C30.7268 45.4481 33.1593 46.0447 33.8579 44.1143C33.9754 43.7767 34.0545 43.419 34.114 43.067C34.1809 42.7843 34.205 42.502 34.2264 42.2133C34.2633 41.9638 34.2821 41.7117 34.3049 41.4606C34.3849 41.0156 34.3829 40.5407 34.4393 40.0889V39.6315V38.6247C34.477 38.5068 34.4859 38.3838 34.5001 38.2613C34.41 33.7957 39.0063 34.0757 42.2771 34.3489C43.0624 34.4145 43.8826 34.586 44.6669 34.5001C46.1725 34.1297 45.7438 30.651 45.4157 29.6383C45.4223 29.5749 45.4163 29.5061 45.4157 29.4421C45.0246 28.9004 45.2497 28.573 45.7679 28.2888C46.1843 28.3173 46.3321 28.5055 46.5107 28.8465C47.0474 30.7277 47.6399 34.9011 45.0876 35.6278C44.2097 35.8778 43.3014 35.6617 42.4125 35.5917C40.953 35.4766 38.1614 35.3335 36.8759 35.9746C35.6022 36.6097 35.7368 38.1233 35.6988 39.3343C35.5541 43.9524 35.4142 47.5959 29.7047 46.5314L29.1172 46.4233C28.8997 46.3925 28.6823 46.341 28.4667 46.2982C28.1766 46.2367 27.888 46.169 27.599 46.1022C27.7448 46.3627 27.8802 46.5631 28.1234 46.7447C28.2348 46.8657 28.3447 47.0043 28.4667 47.1134L28.9558 47.3984C30.9364 48.5261 36.6813 48.7948 37.2428 45.933C37.3937 45.1645 37.3172 42.8714 37.291 42.0304C37.2476 40.632 37.1949 39.3166 37.1841 37.8994C37.1745 36.6424 38.8484 37.0721 39.629 37.1539C40.5935 37.2551 41.5535 37.365 42.5137 37.502C43.7092 37.6726 45.9045 38.2417 46.8842 37.2933C48.2108 36.0092 48.0433 32.4161 48.0737 30.6764C48.0552 30.5199 48.0204 30.3628 47.9918 30.2076C47.988 30.0437 47.9968 29.8799 47.9918 29.7157C47.9522 29.5771 47.9169 29.4404 47.8892 29.2989C47.8869 29.229 47.8884 29.1593 47.8892 29.0894C47.1228 26.9242 47.0244 26.6754 44.8863 25.3937C49.5127 25.4525 49.6612 32.0129 49.0672 35.2557C48.3591 39.1214 46.4528 39.3372 42.9843 38.822C41.536 38.6069 39.8463 38.522 38.4647 38.2613C38.3086 40.2034 38.5732 42.8292 38.5787 44.8527C38.5883 48.507 35.9696 49.4208 32.6866 49.4159C30.2256 49.4122 26.7493 48.6103 26.1941 45.7779C25.8244 43.8924 26.8352 40.494 26.8427 38.3003V38.2613C25.3085 38.5173 23.4932 38.7118 21.9419 38.8841C20.2008 39.0775 18.3613 39.3149 17.1481 37.752C15.8566 36.0884 15.8216 32.3986 16.0871 30.37C16.8385 24.6281 19.9825 25.6586 24.2248 26.2714C25.1956 26.4116 26.1709 26.5064 27.143 26.634C27.4441 24.9433 25.6363 21.4613 26.0363 19.0832C26.8203 14.4222 38.5047 13.3001 39.3378 18.9187C39.5345 20.245 39.0622 22.461 38.8079 23.8129C38.6922 24.4282 38.6101 26.3678 37.6043 26.0743C36.9251 25.4301 37.3527 24.7266 37.5186 23.9151C37.6918 23.0676 38.2615 19.986 38.0846 19.2544ZM18.3901 36.0331C18.127 35.9589 17.8686 35.8933 17.5986 35.8477C17.6826 36.0719 17.7655 36.2961 17.8587 36.5166C17.9368 36.6942 18.0423 36.9683 18.2107 37.0764L18.4751 37.364C19.7315 38.367 25.0305 37.1627 26.8427 37.0764C26.3999 35.357 24.8036 35.9158 23.5263 36.0377C21.8157 36.2008 20.0924 36.3177 18.3901 36.0331Z"
        fill="#212121"
      />
      <path
        d="M45.4159 29.442C45.0984 29.7142 44.8755 30.0958 44.5753 30.3923C44.0242 30.9367 43.2962 31.6179 42.6807 32.0786C41.5078 32.9566 40.2875 33.762 41.4608 32.1446C42.086 31.2827 44.4995 27.9911 45.7681 28.2887C45.2499 28.5729 45.0248 28.9003 45.4159 29.442Z"
        fill="#FF6E04"
      />
      <path
        d="M46.5099 28.8459C46.9742 28.8992 47.4413 28.9446 47.8885 29.0889C47.8877 29.1588 47.8862 29.2285 47.8885 29.2984C47.6399 29.3247 47.1976 29.3157 46.9887 29.4503L46.9671 29.4983C47.1069 29.723 47.749 29.682 47.991 29.7152C47.9961 29.8794 47.9872 30.0432 47.991 30.2071C47.8026 30.2192 47.3551 30.2157 47.2213 30.3677C47.2788 30.4587 47.9207 30.6066 48.0729 30.6758C48.0425 32.4156 48.21 36.0087 46.8834 37.2927C45.9037 38.2411 43.7084 37.672 42.5129 37.5015C41.5528 37.3645 40.5928 37.2546 39.6283 37.1534C38.8476 37.0715 37.1737 36.6419 37.1834 37.8989C37.1942 39.3161 37.2468 40.6315 37.2903 42.0298C37.3164 42.8709 37.3929 45.164 37.2421 45.9325C36.6805 48.7943 30.9356 48.5256 28.9551 47.3979C29.183 47.097 29.435 46.7957 29.7039 46.5308C35.4135 47.5954 35.5534 43.9519 35.6981 39.3338C35.736 38.1228 35.6015 36.6092 36.8751 35.9741C38.1607 35.333 40.9523 35.476 42.4117 35.5912C43.3006 35.6612 44.209 35.8773 45.0868 35.6273C47.6391 34.9006 47.0466 30.7272 46.5099 28.8459Z"
        fill="#FF6E04"
      />
      <path
        d="M44.5907 32.0337C44.3962 32.1733 42.501 34.0456 42.4816 33.3145C42.4599 32.4958 44.7633 30.3732 45.4149 29.6384C45.743 30.6511 46.1717 34.1299 44.6661 34.5002C44.5556 34.141 44.9628 33.4272 45.1312 33.0927C44.9565 33.2024 43.8546 34.2496 43.6859 33.6619C43.5745 33.2735 44.37 32.3931 44.5746 32.0605L44.5907 32.0337Z"
        fill="#FF6E04"
      />
      <path
        d="M18.3899 36.0329C20.0921 36.3175 21.8155 36.2006 23.526 36.0375C24.8034 35.9156 26.3996 35.3568 26.8424 37.0762C25.0302 37.1625 19.7313 38.3668 18.4748 37.3638L18.6026 36.9989C18.4683 37.0275 18.3427 37.03 18.2104 37.0762C18.0421 36.9681 17.9365 36.694 17.8584 36.5164C18.0283 36.3457 18.2004 36.1819 18.3899 36.0329Z"
        fill="#FF6E04"
      />
      <circle
        cx="32.2185"
        cy="32.2735"
        r="29.8289"
        stroke="black"
        stroke-dasharray="2 2"
      />
      <circle
        cx="32.2184"
        cy="32.2737"
        r="31.5871"
        transform="rotate(-15 32.2184 32.2737)"
        stroke="black"
        stroke-dasharray="2 2"
      />
    </svg>
    `,
  bg: "#F6FFEA",
};

const PopularCategory = ({ data }) => {
  // console.log("data", data);
  const { city } = useAuth();
  const [maxItems, setMaxItems] = useState(17);
  const [showAllCategory, setShowAllCategory] = useState(false);

  useEffect(() => {
    const handleResize = () => {
      if (window.innerWidth <= 768) {
        setMaxItems(9);
      } else {
        setMaxItems(17);
      }
    };

    handleResize();
    window.addEventListener("resize", handleResize);
    return () => window.removeEventListener("resize", handleResize);
  }, []);

  const categories = data
    ?.filter((category) => category?.svg_code)
    ?.slice(0, maxItems); // Reserve space for View More

  return (
    <>
      <div className="grid grid-cols-2 sm:grid-cols-3 max-md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-9 gap-4 max-md:gap-0.5 max-md:pl-1.5 max-md:pr-3 md:p-4 w-full">
        {categories?.map((category, index) => (
          <Link
            key={index}
            href={`/${category?.slug?.toLowerCase().replace(/\s+/g, "-")}/${city
              .toLowerCase()
              .replace(/\s+/g, "-")}`}
          >
            <div className="flex flex-col items-center">
              <div
                className="flex flex-col items-center h-23 w-25 max-md:h-20 max-md:w-20 justify-center rounded-xl max-md:scale-75 max-[340px]:!scale-65 shadow hover:shadow-md transition"
                style={{ backgroundColor: category?.colors }}
              >
                <div
                  className="scale-85"
                  dangerouslySetInnerHTML={{ __html: category?.svg_code }}
                />
                <p className="text-[11px] text-center max-md:hidden w-20 font-semibold">
                  {category?.name}
                </p>
              </div>
              <p className="md:hidden text-[10px] max-[340px]:!text-[9px] relative max-sm:bottom-2 text-center font-bold">
                {category?.name}
              </p>
            </div>
          </Link>
        ))}

        {/* View More tile */}
        {data && categories?.length > 0 && (
          <span
            className="cursor-pointer"
            onClick={() => setShowAllCategory(true)}
            key="view-more"
          >
            <div className="flex flex-col items-center">
              <div
                className="flex flex-col items-center h-23 w-25 max-md:h-20 max-md:w-20 justify-center rounded-xl max-md:scale-75 max-[340px]:!scale-65 shadow hover:shadow-md transition"
                style={{ backgroundColor: viewMore?.bg }}
              >
                <div dangerouslySetInnerHTML={{ __html: viewMore?.svg }} />
                <p className="text-[11px] text-center max-md:hidden w-20 font-semibold">
                  {viewMore?.title}
                </p>
              </div>
              <p className="md:hidden text-[10px] max-[340px]:!text-[9px] relative max-sm:bottom-2 text-center font-bold">
                {viewMore?.title}
              </p>
            </div>
          </span>
        )}
      </div>

      {showAllCategory && (
        <AllCategoryPop
          data={data}
          showAllCategory={showAllCategory}
          setShowAllCategory={setShowAllCategory}
        />
      )}
    </>
  );
};

export default PopularCategory;
